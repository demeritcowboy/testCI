name: Testing matrix combinations from json
on:
  workflow_dispatch:
    branches:
      - main
    inputs:
      matrix:
        description: matrix in json format
        required: true
        # To get the desired effect is difficult.
        # If you don't have it in the include or have more than one php-versions with the same other vars in the include, then it only uses the last include for that version.
        # If you try to put arrays into the include for php-versions, then the setup-php doesn't like it.
        # So it seems you can only have one php-version if you want other variables in the matrix?
        default: '{"php-versions":["7.3","7.4"],"include":[{"php-versions":"7.3","drupal":"~9.1.1","civicrm":"5.40.x-dev"},{"php-versions":"7.4","drupal":"~9.2.1","civicrm":"dev-master"}]}'
jobs:
  phpunit:
    runs-on: ubuntu-latest
    strategy:
      matrix: ${{ fromJson(github.event.inputs.matrix) }}
    name: blah
    steps:
      - uses: actions/checkout@v2
      - uses: shivammathur/setup-php@v2
        with:
            php-version: ${{ matrix.php-versions }}
            extensions: dom, curl, libxml, mbstring, zip, pdo, mysql, pdo_mysql, bcmath, soap, intl, gd, exif, iconv, :imagick
            coverage: none
            tools: composer:v2
      - name: Foo
        run: |
          echo ${{ github.event.inputs.matrix }}
          echo ${{ matrix.drupal }}
          echo ${{ matrix.civicrm }}
          php -v
